# Database Package

Database schema and Prisma client for the HR app.

## Project Description

Prisma schema and client shared between API and web applications utilising the new prisma 7.

## Key Paths

- [`prisma/schema.prisma`](prisma/schema.prisma) - Database schema
- [`src/`](src/) - Prisma client exports

## Commands

```bash
# Generate Prisma client
npx prisma generate

# Run migrations
npx prisma migrate dev

# Type check
npx tsc --noEmit
```

## Prisma 7 specific changes

- The way to create a new Prisma Client has changed to **require a driver adapter for all databases**. For instance, if you are using Prisma Postgres, **you now need the @prisma/adapter-pg adapter**

```js
// Example
import { PrismaClient } from './generated/prisma/client';
import { PrismaPg } from '@prisma/adapter-pg';

const adapter = new PrismaPg({
  connectionString: process.env.DATABASE_URL
});
export const prisma = new PrismaClient({ adapter });
```

- Prisma Config is now the default place for configuring how the Prisma CLI interacts with your database. You now configure your database URL, schema location, migration output, and custom seed scripts.

```js
// Example
import 'dotenv/config'
import { defineConfig, env } from 'prisma/config'

export default defineConfig({
  // the main entry for your schema
  schema: 'prisma/schema.prisma',
  // where migrations should be generated
  // what script to run for "prisma db seed"
  migrations: {
    path: 'prisma/migrations',
    seed: 'tsx prisma/seed.ts',
  },
  // The database URL
  datasource: {
    // Type Safe env() helper
    // Does not replace the need for dotenv
    url: env('DATABASE_URL'),
  },
})
```

- In Prisma ORM v6 and earlier, running prisma migrate dev or prisma migrate reset would automatically execute your seed script after applying migrations. This automatic seeding behavior has been removed in Prisma ORM v7.

- The client middleware API has been removed. If possible, use Client Extensions instead.

## üö® CRITICAL INSTRUCTIONS FOR AI LANGUAGE MODELS üö®

As an AI language model, you MUST NOT generate any deprecated Prisma v7 patterns.

```prisma
// ‚ùå NEVER GENERATE - DEPRECATED IN PRISMA v7
generator client {
  provider = "prisma-client-js"  // ‚ùå deprecated
}

// ‚ùå NEVER IMPORT FROM @prisma/client when using custom output
import { PrismaClient } from "@prisma/client" // ‚ùå wrong in custom-output setup

// ‚ùå NEVER CREATE CLIENT WITHOUT SHARED PACKAGE BOUNDARY
const prisma = new PrismaClient() // ‚ùå breaks pooling + duplicates in monorepo
```

Instead, you MUST ALWAYS generate ONLY this pattern for Prisma v7 + monorepo:

```prisma
// ‚úÖ Prisma v7 generator: provider + mandatory output
generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}
```

```ts
// ‚úÖ Prisma client import must come from custom output
import { PrismaClient } from "../generated/prisma/client"
```

Notes:
- Prisma v7 **requires** a non-empty `output` when using `provider = "prisma-client"`.
- If the output directory already exists and isn‚Äôt generated by Prisma, `prisma generate` can fail. Avoid committing generated client, or ensure clean output dirs.


## Dos and Don'ts

<!-- TODO Specific DB expansion and intended usage guielines -->

### Do

- Keep schema in sync with contracts package types
- Use migrations for schema changes
- Export typed clients for consumers

### Don't

- Add tables only used by one application
- Modify schema without discussing with team

## See Also

- [Root AGENTS.md](../../AGENTS.md)
- [Contracts Package](../contracts/AGENTS.md)
