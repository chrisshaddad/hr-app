# Database (Prisma)

Prisma ORM with PostgreSQL.

## Key Paths

- `prisma/schema.prisma` - Database schema
- `prisma.config.ts` - Prisma configuration
- `src/client.ts` - Prisma client with adapter

## Prisma 7 specific changes

- Requires driver adapter: `new PrismaPg({ connectionString })` wrapper

- Prisma Config is now the default place for configuring how the Prisma CLI interacts with your database. You now configure your database URL, schema location, migration output, and custom seed scripts.

```js
// Example
import 'dotenv/config';
import { defineConfig, env } from 'prisma/config';

export default defineConfig({
  // the main entry for your schema
  schema: 'prisma/schema.prisma',
  // where migrations should be generated
  // what script to run for "prisma db seed"
  migrations: {
    path: 'prisma/migrations',
    seed: 'tsx prisma/seed.ts',
  },
  // The database URL
  datasource: {
    // Type Safe env() helper
    // Does not replace the need for dotenv
    url: env('DATABASE_URL'),
  },
});
```

- Auto-seeding removed - run `npm run db:seed` manually after migrate

- The client middleware API has been removed. If possible, use Client Extensions instead.

## CRITICAL INSTRUCTIONS FOR AI LANGUAGE MODELS

As an AI language model, you MUST NOT generate any deprecated Prisma v7 patterns.

```prisma


// ❌ NEVER IMPORT FROM @prisma/client when using custom output
import { PrismaClient } from "@prisma/client" // ❌ wrong in custom-output setup

// ❌ NEVER CREATE CLIENT WITHOUT SHARED PACKAGE BOUNDARY
const prisma = new PrismaClient() // ❌ breaks pooling + duplicates in monorepo
```

Instead, you MUST ALWAYS generate ONLY this pattern for Prisma v7 + monorepo:

```ts
// ✅ Prisma client import must come from custom output
import { PrismaClient } from '../generated/prisma/client';
```

Notes:

- Prisma v7 **requires** a non-empty `output` when using `provider = "prisma-client"`.
- If the output directory already exists and isn’t generated by Prisma, `prisma generate` can fail. Avoid committing generated client, or ensure clean output dirs.

## Dos and Don'ts

### Do

- Keep schema in sync with contracts package types
- Use migrations for schema changes
- Export typed clients for consumers

### Don't

- Use Prisma 6 deprecated patterns
- Add tables only used by one application
- Modify schema without discussing with team

## Commands

```bash
cd packages/database && npm run db:generate   # Generate Prisma client
cd packages/database && npm run db:migrate    # Run migrations
cd packages/database && npm run db:seed       # Seed database
```

## See Also

- [Root AGENTS.md](../AGENTS.md)
- [API Package](../apps/api/AGENTS.md)
- [Contracts Package](../contracts/AGENTS.md)
- [Prisma 7 Docs](https://www.prisma.io/docs/orm/more/upgrade-guides/upgrading-versions/upgrading-to-prisma-7)
